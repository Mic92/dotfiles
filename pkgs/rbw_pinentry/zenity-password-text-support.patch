From 15fcf5f58cc98176ff25fd283e36ccf8027a6251 Mon Sep 17 00:00:00 2001
From: =?UTF-8?q?J=C3=B6rg=20Thalheim?= <joerg@thalheim.io>
Date: Tue, 4 Nov 2025 08:18:31 +0100
Subject: [PATCH] password: Add support for --text option
MIME-Version: 1.0
Content-Type: text/plain; charset=UTF-8
Content-Transfer-Encoding: 8bit

The password dialog now supports the --text option to display custom
text to the user, similar to other dialogs like forms, entry, and
calendar.

This is useful for providing context or error messages in password
prompts. For example:
  zenity --password --text="Authentication failed. Please try again."

If no --text is provided, the dialog displays the default message
"Type your password" (or "Type your username and password" when
--username is used).

Signed-off-by: JÃ¶rg Thalheim <joerg@thalheim.io>
---
 src/option.c   |  1 +
 src/password.c | 19 ++++++++++++-------
 src/zenity.h   |  1 +
 3 files changed, 14 insertions(+), 7 deletions(-)

diff --git a/src/option.c b/src/option.c
index 58ee384..9625836 100644
--- a/src/option.c
+++ b/src/option.c
@@ -2003,6 +2003,7 @@ zenity_password_post_callback (GOptionContext *context, GOptionGroup *group,
 	zenity_option_set_dialog_mode (zenity_password_active, MODE_PASSWORD);
 
 	if (results->mode == MODE_PASSWORD) {
+		results->password_data->dialog_text = zenity_general_dialog_text;
 		results->password_data->username = zenity_password_show_username;
 	} else {
 		if (zenity_password_show_username)
diff --git a/src/password.c b/src/password.c
index 48cbc17..eb69390 100644
--- a/src/password.c
+++ b/src/password.c
@@ -75,15 +75,20 @@ zenity_password_dialog (ZenityData *data, ZenityPasswordData *password_data)
 	grid = GTK_WIDGET(gtk_builder_get_object (builder,
 				"zenity_password_grid"));
 
-	/* Checks if username has been passed as a parameter */
-	if (password_data->username)
-	{
-		/* Change the password label to ask for both username and password */
-		label = GTK_WIDGET(gtk_builder_get_object (builder,
-					"zenity_password_title"));
+	/* Set the dialog text if provided, otherwise use default */
+	label = GTK_WIDGET(gtk_builder_get_object (builder,
+				"zenity_password_title"));
+	if (password_data->dialog_text) {
+		gtk_label_set_text (GTK_LABEL(label), password_data->dialog_text);
+	} else if (password_data->username) {
 		gtk_label_set_text (GTK_LABEL(label),
 				_("Type your username and password"));
+	}
+	/* else keep default "Type your password" from UI file */
 
+	/* Checks if username has been passed as a parameter */
+	if (password_data->username)
+	{
 		/* Add the username label and entry and increment the row for the
 		 * password entry so it will be added below the username.
 		 */
@@ -91,7 +96,7 @@ zenity_password_dialog (ZenityData *data, ZenityPasswordData *password_data)
 		gtk_grid_attach (GTK_GRID(grid), label,
 				0,		/* col */
 				0,		/* row */
-				1, 1);	/* width/height by cell. */	
+				1, 1);	/* width/height by cell. */
 
 		password_data->entry_username = gtk_entry_new ();
 		gtk_grid_attach (GTK_GRID(grid), password_data->entry_username,
diff --git a/src/zenity.h b/src/zenity.h
index 8024d04..8a6f10a 100644
--- a/src/zenity.h
+++ b/src/zenity.h
@@ -165,6 +165,7 @@ typedef struct {
 } ZenityFormsValue;
 
 typedef struct {
+	char *dialog_text;
 	gboolean username;
 	char *password;
 	GtkWidget *entry_username;
-- 
2.51.0

